- type: replace
  path: /releases/-
  value:
    name: service-metrics
    version: latest

- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: service-metrics-adapter
    release: ((broker_release))
    properties:
      broker_uri: http://q-s0.broker.((meta.services_subnet)).((broker_deployment_name)).bosh:8080
      tls:
        ca_cert: ((broker_cert.ca))


- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: service-metrics
    release: service-metrics
    properties:
      service_metrics:
        execution_interval_seconds: 30
        origin: ((broker_deployment_name))
        monit_dependencies: [broker]
        tls:
          ca: ((loggregator.tls.ca_cert))
          cert: ((loggregator.tls.client.certificate))
          key: ((loggregator.tls.client.private_key))

- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: metron_agent
    release: loggregator
    properties:
      metron_agent:
        deployment: ((broker_deployment_name))
        protocols:
          - tls
        tls:
          metron:
            cert: ((loggregator.tls.client.certificate))
            key: ((loggregator.tls.client.private_key))
      loggregator:
        etcd:
          machines:
          - cf-etcd.service.cf.internal
          require_ssl: true
        tls:
          metron:
            cert: ((loggregator.tls.client.certificate))
            key: ((loggregator.tls.client.private_key))
          ca_cert: ((loggregator.tls.ca_cert))

