---
- type: replace
  path: /instance_groups/name=broker/jobs/name=broker/consumes?
  value:
    credhub:
      from: credhub
      deployment: ((cf.deployment_name))

- type: replace
  path: /instance_groups/name=broker/jobs/name=broker/properties/secure_binding_credentials?
  value:
    enabled: true
    authentication:
      uaa:
        ca_cert: ((cf.uaa.ca_cert))
        client_id: ((credhub.client_id))
        client_secret: ((credhub.client_secret))


- type: replace
  path: /instance_groups/name=broker/jobs/-
  value:
    name: bosh-dns-aliases
    properties:
      aliases:
      - domain: credhub.service.cf.internal
        targets:
        - deployment: ((cf.deployment_name))
          domain: bosh
          instance_group: ((cf.instance_group_for_credhub))
          network: default
          query: '*'
      - domain: uaa.service.cf.internal
        targets:
        - deployment: ((cf.deployment_name))
          domain: bosh
          instance_group: ((cf.instance_group_for_uaa))
          network: default
          query: '*'
    release: bosh-dns-aliases

- type: replace
  path: /releases/-
  value:
    name: bosh-dns-aliases
    version: latest